{% extends 'base.html' %}
{% block title %}Приём пациента{% endblock %}

{% block content %}
  <h1>Приём пациента</h1>

  <form method="post">
    {% csrf_token %}

    <div class="cards">

      <div class="card">
        <div class="card-title">Общие данные</div>
        <div class="grid-2">
          <div class="field">
            {{ form.title.label_tag }}
            {{ form.title }}
            {% if form.title.errors %}<div class="errors">{{ form.title.errors }}</div>{% endif %}
          </div>
          <div class="field">
            {{ form.text.label_tag }}
            {{ form.text }}
            {% if form.text.errors %}<div class="errors">{{ form.text.errors }}</div>{% endif %}
          </div>
          
          <div class="field">
            {{ form.next_date.label_tag }}
            {{ form.next_date }}
            {% if form.next_date.errors %}<div class="errors">{{ form.next_date.errors }}</div>{% endif %}
          </div>
        </div>
      </div>

      {# Блок 1: Данные пациента #}
      <div class="card">
        <div class="card-title">Данные пациента</div>
        <div class="grid-2">
          <div class="field">
            {{ patient.full_name }}
          </div>
        </div>
      </div>

      {# Блок 2: жалобы и анамнез #}
      <div class="card">
        <div class="card-title">Жалобы и анамнез</div>
        <div class="field">
          {{ form.complaints.label_tag }}
          {{ form.complaints }}
          {% if form.complaints.errors %}<div class="errors">{{ form.complaints.errors }}</div>{% endif %}
        </div>
        <div class="field" style="margin-top:10px;">
          {{ form.anamnesis.label_tag }}
          {{ form.anamnesis }}
          {% if form.anamnesis.errors %}<div class="errors">{{ form.anamnesis.errors }}</div>{% endif %}
        </div>
      </div>

      {# Блок 3: Диетологический анамнез #}
      <div class="card">
      <div class="card-title">Диетологический анамнез</div>
        <div class="grid-1">
          <div class="field">
            <div class="field" style="margin-top:10px;">
              {{ form.diet.label_tag }}
              {{ form.diet }}
              {% if form.diet.errors %}<div class="errors">{{ form.diet.errors }}</div>{% endif %}
            </div>
          </div>
          <div class="field">
            {{ form.mealscount.label_tag }}
            {{ form.mealscount }}
            {% if form.mealscount.errors %}<div class="errors">{{ form.mealscount.errors }}</div>{% endif %}
          </div>
          <div class="field">
            {{ form.snacks.label_tag }}
            {{ form.snacks }}
            {% if form.snacks.errors %}<div class="errors">{{ form.snacks.errors }}</div>{% endif %}
          </div>
          
          <div class="field">
            <label>Предпочтения</label>
            <div class="checkbox-group">
            {% for field in form %}
              {% if field.name in prefs %}
                {{ field.label_tag }}
                {{ field }}
                {% if field.errors %}<div class="errors">{{ field.errors }}</div>{% endif %}
              {% endif %}
            {% endfor %}
            </div>
          </div>
          
          <div class="field">
            <label>Наличие непереносимости:</label>
            <div class="checkbox-group">
            {% for field in form %}
              {% if field.name in intols %}
                {{ field.label_tag }}
                {{ field }}
                {% if field.errors %}<div class="errors">{{ field.errors }}</div>{% endif %}
              {% endif %}
            {% endfor %}
            </div>
          </div>
          <div class="field">
            {{ form.comment_diet.label_tag }}
            {{ form.comment_diet }}
            {% if form.comment_diet.errors %}<div class="errors">{{ form.comment_diet.errors }}</div>{% endif %}
          </div>
        </div>
      </div>

      {# Блок 4: Наследственность #}
      <div class="card">
        <div class="card-title">Укажите наличие заболеваний у ближайших родственников (отметьте подходящее):</div>

        <div class="grid-2">

            {% for k, v in form.heredity.items %}
            <div class="field">
                {{ k.label_tag }}
                <div class="checkbox-group">
                {{ k }}
                {{ v }}
                </div>
                {% if k.errors %}<div class="errors">{{ k.errors }}</div>{% endif %}
                {% if v.errors %}<div class="errors">{{ v.errors }}</div>{% endif %}
            </div>
            {% endfor %}
        </div>
      </div>
      
      
      {# Блок 5: Аллергологический анамнез #}
      <div class="card">
        <div class="card-title">Аллергологический анамнез:</div>
        <div class="grid-1">
          
            {% for field in form %}
              {% if field.name in allergies %}
              <div class="field">
                {{ field.label_tag }}
                {{ field }}
                {% if field.errors %}<div class="errors">{{ field.errors }}</div>{% endif %}
              </div>
              {% endif %}
            {% endfor %}
         
        </div>
      </div>
      
      
        {# Блок 6: Данные осмотра #}
      <div class="card">
        <div class="card-title">Данные осмотра:</div>

        <div class="grid-2">
           <div class="field">
            {{ form.insp_General.label_tag }}
            {{ form.insp_General }}
            {% if form.insp_General.errors %}<div class="errors">{{ form.insp_General.errors }}</div>{% endif %}
          </div>
          
          <div class="field">
            {{ form.insp_Body.label_tag }}
            {{ form.insp_Body }}
            {% if form.insp_Body.errors %}<div class="errors">{{ form.insp_Body.errors }}</div>{% endif %}
          </div>
          
          
          <div class="field">
            <label>{{ form.insp_skin.label }}</label>
            <div class="checkbox-group">
              {{ form.insp_skin }}
            </div>
            {% if form.insp_skin.errors %}<div class="errors">{{ form.insp_skin.errors }}</div>{% endif %}
            {% if form.insp_skin.help_text %}<div class="help">{{ form.insp_skin.help_text }}</div>{% endif %}
          </div>

          <div class="field">
            <label>{{ form.insp_lymph.label }}</label>
            <div class="checkbox-group">
              {{ form.insp_lymph }}
            </div>
            {% if form.insp_lymph.errors %}<div class="errors">{{ form.insp_lymph.errors }}</div>{% endif %}
            {% if form.insp_lymph.help_text %}<div class="help">{{ form.insp_lymph.help_text }}</div>{% endif %}
          </div>
          
          
          
          <div class="field">
            <label>{{ form.insp_thyroid.label }}</label>
            <div class="checkbox-group">
              {{ form.insp_thyroid }}
            </div>
            {% if form.insp_thyroid.errors %}<div class="errors">{{ form.insp_thyroid.errors }}</div>{% endif %}
            {% if form.insp_thyroid.help_text %}<div class="help">{{ form.insp_thyroid.help_text }}</div>{% endif %}
          </div>
          
          <div class="field">
            {{ form.insp_Abdomen.label_tag }}
            {{ form.insp_Abdomen }}
            {% if form.insp_Abdomen.errors %}<div class="errors">{{ form.insp_Abdomen.errors }}</div>{% endif %}
          </div>
          
          
          
          <div class="field">
            {{ form.insp_Liver.label_tag }}
            {{ form.insp_Liver }}
            {% if form.insp_Liver.errors %}<div class="errors">{{ form.insp_Liver.errors }}</div>{% endif %}
          </div>
          
          
          <div class="field">
            {{ form.insp_Liver_protudes.label_tag }}
            {{ form.insp_Liver_protudes }} см
            {% if form.insp_Liver_protudes.errors %}<div class="errors">{{ form.insp_Liver_protudes.errors }}</div>{% endif %}
          </div>

          <div class="field">
            <label>{{ form.insp_musculoskeletal.label }}</label>
            <div class="checkbox-group">
              {{ form.insp_musculoskeletal }}
            </div>
            {% if form.insp_musculoskeletal.errors %}<div class="errors">{{ form.insp_musculoskeletal.errors }}</div>{% endif %}
            {% if form.insp_musculoskeletal.help_text %}<div class="help">{{ form.insp_musculoskeletal.help_text }}</div>{% endif %}
          </div>
          
          <div class="field">
            {{ form.insp_Limbs.label_tag }}
            {{ form.insp_Limbs }}
            {% if form.insp_Limbs.errors %}<div class="errors">{{ form.insp_Limbs.errors }}</div>{% endif %}
          </div>

          <div class="field">
            {{ form.insp_Other.label_tag }}
            {{ form.insp_Other }}
            {% if form.insp_Other.errors %}<div class="errors">{{ form.insp_Other.errors }}</div>{% endif %}
          </div>

        </div>
      </div>

      
        {# Блок 6: Образ жизни #}
      <div class="card">
        <div class="card-title">Образ жизнь:</div>
        {% for field in form.lifeStyles %}
        <div class="field"  style="margin-top:6px;">
        <label>{{ field.label }}</label>
        {% if field.label == "COVID-19" %}
          <div style="align:left">
              {{ field}}
          </div>
        {% else %}
        {{ field }}
        {% endif %}
        {% if field.errors %}<div class="errors">{{ field.errors }}</div>{% endif %}
        {% endfor %}
      </div>
     
        
      </div>

    </div>

    <div class="actions">
      <button type="submit" class="btn btn-primary">Сохранить</button>
      {% if patient %}
      <a href="{% url 'patient_detail' patient.pk %}" class="btn btn-secondary">Отмена</a>
      {% else %}
      <a href="{% url 'dashboard'%}" class="btn btn-secondary">Отмена</a>
      {% endif %}
    </div>
  </form>
{% endblock %}


