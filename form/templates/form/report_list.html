{% extends 'base.html' %}

{% block title %}Приёмы{% endblock %}

{% block content %}
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
    <h1>Приёмы</h1>
    <a href="{% url 'report_new' %}" class="btn btn-primary">
      Новый приём
    </a>
  </div>

  <section class="card">
    <header class="card-header" style="margin-bottom:8px;">
      <h2 class="card-title">Список приёмов</h2>
    </header>

    {% if reports %}
      <ol class="item-list" style="list-style:none;margin:0;padding:0;">
        {% for form in reports %}
          <li class="item-card">

            <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">

              <!-- Левая часть: информация о приёме -->
              <div>
                <a href="{% url 'report_detail' pk=form.pk %}" class="item-card-title">
                  {{ form.title }}
                </a>

                <div class="item-card-meta">
                  {# Пациент #}
                  {% if form.patient %}
                    Пациент:
                    <a href="{% url 'patient_detail' pk=form.patient.pk %}" class="item-card-meta-link">
                      {{ form.patient.full_name }}
                    </a>
                  {% else %}
                    <span class="muted">Пациент не указан</span>
                  {% endif %}
                  ·
                  {# Дата приёма #}
                  <span class="muted">
                    {{ form.createв_date|date:"d.m.Y H:i" }}
                  </span>
                </div>

                {% if form.text %}
                  <div class="item-card-text">
                    {{ form.text|truncatechars:160 }}
                  </div>
                {% endif %}
              </div>

              <!-- Правая часть: кнопка -->
              <div>
                <a href="{% url 'report_detail' pk=form.pk %}" class="btn btn-secondary" style="white-space:nowrap;">
                  Открыть
                </a>
              </div>

            </div>

          </li>
        {% endfor %}
      </ol>
    {% else %}
      <p class="muted">Приёмы ещё не добавлены.</p>
    {% endif %}
  </section>
{% endblock %}
